{% extends "shop/base.html" %}
{% load static %}

{% block title %}
{% endblock %}

{% block content %}
    <section class="py-5">
        <div class="container py-5">
            <div class="row mx-auto">
                <div class="col">
                    <div data-reflow-type="shopping-cart">
                        <div class="reflow-shopping-cart" style="display: block;">
                            <div class="ref-loading-overlay"></div>
                            <div class="ref-message" style="display: none;"></div>
                            <div class="ref-checkout">
                                <div class="ref-checkout-content">
                                    <form id="creerCommandeForm" class="ref-details" style="display: block;" action="{% url "orders:creer_commande" %}" method="post">
                                        {% csrf_token %}
                                        <div class="ref-back">
                                            <a href="{% url "cart:panier_detail" %}">
                                                ← retour au panier
                                            </a>
                                        </div>
                                        <div class="ref-heading">Infos du client</div>
                                        <div class="text-center ref-auth-button-holder" style="display: block;">
                                            <div class="ref-auth-button" data-reflow-type="auth-button">
                                                <div class="reflow-auth-button">
                                                    {% if utilisateur.is_authenticated %}
                                                        <div class="ref-auth-button-signed" style="display: block;">
                                                            <a class="ref-profile-info" href="{% url "account:profile_edit" %}">
                                                                {% if utilisateur.image %}
                                                                    <img class="ref-profile-photo rounded-circle" src="{{ utilisateur.image.url }}" width="45" height="45">
                                                                    <span class="ref-profile-name" style="color: darkgrey">{{ utilisateur.prenom }} {{ utilisateur.nom }}</span>
                                                                {% else %}
                                                                    <svg class="bi bi-person" xmlns="http://www.w3.org/2000/svg" width="45" height="45" fill="currentColor" viewBox="0 0 16 16">
                                                                        <path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6Zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0Zm4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4Zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10Z"></path>
                                                                    </svg>
                                                                {% endif %}
                                                            </a>
                                                        </div>
                                                    {% else %}
                                                        <div class="ref-auth-button-guest">
                                                            <div class="ref-button ref-sign-in">
                                                                <a href="{% url "account:connexion" %}">
                                                                    Se Connecter
                                                                </a>
                                                            </div>
                                                            <div class="ref-register">
                                                                Vous ne possedez pas un compte?
                                                                <span class="text-primary">
                                                                    <a href="{% url "account:compte_creation" %}">Creez-en!</a>
                                                                    <span>
                                                                    </span>
                                                                </span>
                                                            </div>
                                                        </div>
                                                    {% endif %}
                                                </div>
                                            </div>
                                        </div>
                                        <label>
                                            {{ formulaire.email }}
                                        </label>
                                        <label class="ref-phone-input">
                                            {{ formulaire.telephone }}
                                            <div class="ref-validation-error">
                                            </div>
                                        </label>
                                        <div class="ref-heading ref-heading-delivery" style="display: block;">Livraison</div>
                                        <div class="ref-delivery-card bg-light shadow" style="display: block;">
                                            <div class="ref-tab ref-shipping-tab open" data-ref-delivery="shipping" style="display: block;">
                                                <fieldset class="ref-tab-content">
                                                    <div class="ref-shipping-address-holder">
                                                        <div class="ref-address-widget">
                                                            <label>
                                                                <span>Nom</span>
                                                                {{ formulaire.nom }}
                                                            </label>
                                                            <label>
                                                                <span>Adresse</span>
                                                                {{ formulaire.adresse }}
                                                            </label>
                                                            <label>
                                                                <span>Ville</span>
                                                                {{ formulaire.ville }}
                                                            </label>
                                                            <div class="ref-row ref-row-region">
                                                                <label>
                                                                    <span>Code Postal</span>
                                                                    {{ formulaire.code_postal }}
                                                                </label>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="ref-auth-save-address" style="display: block;">
                                                        <label>
                                                            <input type="checkbox" name="auth-save-address" checked />
                                                            <span>Enregistrer mon adresse pour les futurs achats</span>
                                                        </label>
                                                    </div>
                                                </fieldset>
                                            </div>
                                        </div>
                                        <div>
                                            <div class="ref-heading ref-heading-payment" style="display: block;">Paiement</div>
                                            <div id="creer_commande_btn" class="ref-paypal-payment-holder" style="display: block;">
                                                <div class="paypal-button paypal-button-gold button-demo-payment shadow" style="background-color: white;">
                                                    <svg xmlns="http://www.w3.org/2000/svg" height="22" viewBox="0 0 101 32" preserveAspectRatio="xMinYMin meet">
                                                        <path fill="#003087" d="M 12.237 2.8 L 4.437 2.8 C 3.937 2.8 3.437 3.2 3.337 3.7 L 0.237 23.7 C 0.137 24.1 0.437 24.4 0.837 24.4 L 4.537 24.4 C 5.037 24.4 5.537 24 5.637 23.5 L 6.437 18.1 C 6.537 17.6 6.937 17.2 7.537 17.2 L 10.037 17.2 C 15.137 17.2 18.137 14.7 18.937 9.8 C 19.237 7.7 18.937 6 17.937 4.8 C 16.837 3.5 14.837 2.8 12.237 2.8 Z M 13.137 10.1 C 12.737 12.9 10.537 12.9 8.537 12.9 L 7.337 12.9 L 8.137 7.7 C 8.137 7.4 8.437 7.2 8.737 7.2 L 9.237 7.2 C 10.637 7.2 11.937 7.2 12.637 8 C 13.137 8.4 13.337 9.1 13.137 10.1 Z"></path>
                                                        <path fill="#003087" d="M 35.437 10 L 31.737 10 C 31.437 10 31.137 10.2 31.137 10.5 L 30.937 11.5 L 30.637 11.1 C 29.837 9.9 28.037 9.5 26.237 9.5 C 22.137 9.5 18.637 12.6 17.937 17 C 17.537 19.2 18.037 21.3 19.337 22.7 C 20.437 24 22.137 24.6 24.037 24.6 C 27.337 24.6 29.237 22.5 29.237 22.5 L 29.037 23.5 C 28.937 23.9 29.237 24.3 29.637 24.3 L 33.037 24.3 C 33.537 24.3 34.037 23.9 34.137 23.4 L 36.137 10.6 C 36.237 10.4 35.837 10 35.437 10 Z M 30.337 17.2 C 29.937 19.3 28.337 20.8 26.137 20.8 C 25.037 20.8 24.237 20.5 23.637 19.8 C 23.037 19.1 22.837 18.2 23.037 17.2 C 23.337 15.1 25.137 13.6 27.237 13.6 C 28.337 13.6 29.137 14 29.737 14.6 C 30.237 15.3 30.437 16.2 30.337 17.2 Z"></path>
                                                        <path fill="#003087" d="M 55.337 10 L 51.637 10 C 51.237 10 50.937 10.2 50.737 10.5 L 45.537 18.1 L 43.337 10.8 C 43.237 10.3 42.737 10 42.337 10 L 38.637 10 C 38.237 10 37.837 10.4 38.037 10.9 L 42.137 23 L 38.237 28.4 C 37.937 28.8 38.237 29.4 38.737 29.4 L 42.437 29.4 C 42.837 29.4 43.137 29.2 43.337 28.9 L 55.837 10.9 C 56.137 10.6 55.837 10 55.337 10 Z"></path>
                                                        <path fill="#009cde" d="M 67.737 2.8 L 59.937 2.8 C 59.437 2.8 58.937 3.2 58.837 3.7 L 55.737 23.6 C 55.637 24 55.937 24.3 56.337 24.3 L 60.337 24.3 C 60.737 24.3 61.037 24 61.037 23.7 L 61.937 18 C 62.037 17.5 62.437 17.1 63.037 17.1 L 65.537 17.1 C 70.637 17.1 73.637 14.6 74.437 9.7 C 74.737 7.6 74.437 5.9 73.437 4.7 C 72.237 3.5 70.337 2.8 67.737 2.8 Z M 68.637 10.1 C 68.237 12.9 66.037 12.9 64.037 12.9 L 62.837 12.9 L 63.637 7.7 C 63.637 7.4 63.937 7.2 64.237 7.2 L 64.737 7.2 C 66.137 7.2 67.437 7.2 68.137 8 C 68.637 8.4 68.737 9.1 68.637 10.1 Z"></path>
                                                        <path fill="#009cde" d="M 90.937 10 L 87.237 10 C 86.937 10 86.637 10.2 86.637 10.5 L 86.437 11.5 L 86.137 11.1 C 85.337 9.9 83.537 9.5 81.737 9.5 C 77.637 9.5 74.137 12.6 73.437 17 C 73.037 19.2 73.537 21.3 74.837 22.7 C 75.937 24 77.637 24.6 79.537 24.6 C 82.837 24.6 84.737 22.5 84.737 22.5 L 84.537 23.5 C 84.437 23.9 84.737 24.3 85.137 24.3 L 88.537 24.3 C 89.037 24.3 89.537 23.9 89.637 23.4 L 91.637 10.6 C 91.637 10.4 91.337 10 90.937 10 Z M 85.737 17.2 C 85.337 19.3 83.737 20.8 81.537 20.8 C 80.437 20.8 79.637 20.5 79.037 19.8 C 78.437 19.1 78.237 18.2 78.437 17.2 C 78.737 15.1 80.537 13.6 82.637 13.6 C 83.737 13.6 84.537 14 85.137 14.6 C 85.737 15.3 85.937 16.2 85.737 17.2 Z"></path>
                                                        <path fill="#009cde" d="M 95.337 3.3 L 92.137 23.6 C 92.037 24 92.337 24.3 92.737 24.3 L 95.937 24.3 C 96.437 24.3 96.937 23.9 97.037 23.4 L 100.237 3.5 C 100.337 3.1 100.037 2.8 99.637 2.8 L 96.037 2.8 C 95.637 2.8 95.437 3 95.337 3.3 Z"></path>
                                                    </svg>
                                                </div>
                                            </div>
                                            <div class="ref-standard-payment-buttons">
                                                <div class="ref-button ref-payment-button ref-payment-card button-demo-payment shadow"  data-method="stripe">Carte de credit</div>
                                                <div class="ref-button ref-payment-button ref-payment-apple-pay-google-pay button-demo-payment shadow" data-method="stripe">Apple Pay / Google Pay</div>
                                            </div>
                                        </div>
                                    </form>
                                    <div class="ref-links">
                                        <a href="https://google.com" target="_blank">Conditions d'utilisation</a>
                                        <a href="https://google.com" target="_blank">Engagement de confidentialité</a>
                                        <a href="https://google.com" target="_blank">Politique de remboursements</a>
                                    </div>
                                </div>
                                <div class="ref-checkout-summary shadow" style="background-color: #f5f6f8 !important">
                                    <div class="ref-heading">Details de la commande</div>
                                    <div class="ref-products">
                                        {% for item in panier %}
                                            <div class="ref-product">
                                                <div class="ref-product-col">
                                                    <a href="{{ item.produit.get_absolute_url }}">
                                                        <img class="ref-product-photo" src="{{ item.produit.image.url }}" alt="{{ item.produit.slug }}"/>
                                                    </a>
                                                    <div>
                                                        <a href="{{ item.produit.get_absolute_url }}">
                                                            <div class="ref-product-name">{{ item.produit.nom }}</div>
                                                        </a>
                                                        <div class="ref-product-secondary">${{ item.produit.prix }} x {{ item.quantite }}</div>
                                                    </div>
                                                </div>
                                                <div>
                                                    <div class="ref-product-total">${{ item.prix_total }}</div>
                                                </div>
                                            </div>
                                        {% endfor %}
                                    </div>
                                    <hr style="display: block;" />
                                    <div class="ref-totals">
                                        <div class="ref-subtotal">
                                            <div class="ref-row">
                                                <span>Somme totale</span>
                                                <span>${{ panier.get_prix_total }}</span>
                                            </div>
                                        </div>
                                        <div class="ref-shipping" style="display: block;">
                                            <div class="ref-row">
                                                <span>Livraison (Dans tout le pays)</span>
                                                <span>$0.00</span>
                                            </div>
                                        </div>
                                    </div>
                                    <hr />
                                    <div class="ref-total">
                                        <div class="ref-row">
                                            <span>Total</span>
                                            <span>${{ panier.get_prix_total }}</span>
                                        </div>
                                        <div class="ref-total-note">Tous les prix sont en dollars USD.</div>
                                    </div>
                                </div>
                                <div class="ref-summary-toggle ref-field-collapsible">
                                    <span class="ref-field-toggle">
                                        <span class="ref-field-toggle-title">Details</span>
                                        <span class="ref-summary-total">${{ panier.get_prix_total }}</span>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
{% endblock %}